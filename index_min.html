<button id="F">Go</button><canvas id="S" style="width: 100vw; height: 100vh; image-rendering: pixelated;"></canvas>
<script>
var A=new AudioContext,N=[];function play_tone(e){for(var f=A.createOscillator(),h=A.createGain(),c=-1,a=0;a<N.length;a++)if(!N[a]){c=a;break}-1==c&&(c=N.length);f.connect(h);h.connect(A.destination);f.type="square";f.frequency.value=e;h.gain.value=.005;f.start();N[c]=f;return c}function stop_tone(e){N[e]&&(N[e].stop(),N[e]=null)}
function run(e){var f=new Image;f.onload=function(){var f={env:{c:Math.cos,q:Math.sqrt,a:Math.atan2,P:play_tone,S:stop_tone}},c=document.createElement("canvas");c.width=this.width;c.height=this.height;var a=c.getContext("2d");a.drawImage(this,0,0);c=a.getImageData(0,0,c.width,c.height).data.buffer;a=new ArrayBuffer(c.byteLength/4*3-1);for(var e=new Int8Array(c),g=new Int8Array(a),d=0;d<c.byteLength/4;d++)g[3*d]=e[4*d],g[3*d+1]=e[4*d+1],g[3*d+2]=e[4*d+2];WebAssembly.instantiate(a,f).then(function(c){function e(b){k&&
(a.T(g,360,400,b),b=new Uint8ClampedArray(a.memory.buffer,g,576E3),b=new ImageData(b,360,400),h.putImageData(b,0,0),window.requestAnimationFrame(e))}function f(b){a.mm(b.movementX,b.movementY)}var a=c.instance.exports,d=document.getElementById("S");d.width=360;d.height=400;var h=d.getContext("2d"),g=a.alloc(576E3),k=!1;document.addEventListener("keydown",function(b){void 0!==b.repeat&&b.repeat||a.kd(b.charCode||b.keyCode)},!1);document.addEventListener("keyup",function(b){a.ku(b.charCode||b.keyCode)},
!1);document.addEventListener("mousedown",function(b){a.md(b.button)},!1);document.addEventListener("mouseup",function(b){a.mu(b.button)},!1);document.addEventListener("pointerlockchange",function(){document.pointerLockElement===d?(document.addEventListener("mousemove",f,!1),k=!0,window.requestAnimationFrame(e)):(document.removeEventListener("mousemove",f,!1),k=!1)},!1);document.addEventListener("webkitfullscreenchange",function(b){if(document.webkitIsFullScreen)d.requestPointerLock();else{document.exitPointerLock();
for(var a in N)N[a]&&N[a].stop()}},!1);document.getElementById("F").addEventListener("click",function(a){d.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)})})};f.src=e}run("b");
</script>
